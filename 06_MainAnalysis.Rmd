---
title: "06_Main Analysis"
author: "Chiara Draxler"
date: "24 1 2022"
output: html_document
---

#1. Load Data
```{r}
load("cccu_MA.RData")
```


#2. Load Packages
```{r}
library(formr)
library(effects)
library(lme4)
library(psych)
library(dplyr)
```


#3. Models

##3.1 Model 1: basic model
```{r}
m1 <- glmer(switch ~ hc + (1| CASEID), family = binomial, data = cccu_MA, control=glmerControl(optimizer="bobyqa"))

summary(m1)
confint(m1, method = "Wald", level = .997)
plot(allEffects(m1))
```


##3.2 Model 2: including directly with contraceptive method associated predictors
```{r}
m2 <- glmer(switch ~ hc*contra_satis + (1| CASEID), family = binomial, data = cccu_MA, control=glmerControl(optimizer="bobyqa"))

summary(m2)
confint(m2, method = "Wald", level = .997)
plot(allEffects(m2))
```


##3.3 Model 3: including not directly with contraceptive method associated predictors
```{r}
m3 <- glmer(switch ~ hc * contra_satis +  hc * sexual_satisfaction + hc * sex_freq  + (1| CASEID), family = binomial, data = cccu_MA, control=glmerControl(optimizer="bobyqa"))

summary(m3)
confint(m3, method = "Wald", level = .997)
plot(allEffects(m3))
```

##3.4 Model 4: Controlling for observed selection effects
```{r}
m3 <- glm(switch ~ hc * contra_satis + hc * sexual_satisfaction +  hc * sex_freq,
          family = binomial,
          data = cccu_MA)
summary(m3)


m4 <- glm(switch ~ hc * contra_satis + hc * sexual_satisfaction +  hc * sex_freq + hc *AGE + hc *DEGREE_recode + hc *POVRATE +
              hc *HLTHPROB_recode + hc *MEDPROB_recode +  hc *GAPINS_recode +
              hc *TYPEINS_recode + hc *NKIDS_t1 +  hc *pregnant_between_waves + hc *had_baby_between_waves+ hc *Avoid_r + hc *FEELPG_recode +
              hc *rel_dur_factor,
            family = binomial,
            data = cccu_MA)
summary(m4)

m4 <- glmer(switch ~ hc * contra_satis + hc * sexual_satisfaction +  hc * sex_freq + AGE + DEGREE_recode +
              POVRATE + HLTHPROB_recode + MEDPROB_recode +  GAPINS_recode +
              TYPEINS_recode + NKIDS_t1 +  pregnant_between_waves + had_baby_between_waves+ Avoid_r +
              FEELPG_recode + rel_dur_factor + (1| CASEID),
            family = binomial,
            data = cccu_MA,
            control=glmerControl(optimizer="bobyqa"))


m4 <- glmer(switch ~ hc * contra_satis + hc * sexual_satisfaction +  hc * sex_freq + hc *AGE + hc *DEGREE_recode +
              hc *POVRATE + hc *HLTHPROB_recode + hc *MEDPROB_recode +  hc *GAPINS_recode +
              hc *TYPEINS_recode + hc *NKIDS_t1 +  hc *pregnant_between_waves + hc *had_baby_between_waves+ hc *Avoid_r +
              hc *FEELPG_recode + hc *rel_dur_factor + (1| CASEID),
            family = binomial,
            data = cccu_MA,
            control=glmerControl(optimizer="bobyqa"))

summary(m4)
confint(m4, method = "Wald", level = .997)
plot(allEffects(m4))
```




