---
title: "02_Datawrangling"
author: "Chiara Draxler"
date: "6 1 2022"
output: html_document
---

#1.Load Data
```{r}
load("Fake_cccu_complete.RData")

```


#2.Load Packages
```{r}
#loading dplyr
library("dplyr")
library(formr)
library("tidyverse")

```


#3. Selecting necessary columnsfor thesis' question 
```{r}
#Getting overview over columns
colnames(Fake_cccu_complete)

```
List of necessary columns:
CASEID
WAVE
WEIGHT 
AGE
DEGREE
POVRATE
POVCAT
TYPEINS
MEDPROB
GAPINS
HLTHPROB
AVOID
FEELPG
NBIRTHS
BIRTH3MO
PREG
MONTHSA
MONTHSB
MONTHSC
MOTNHSD1
MONTHSD3
MONTHSE1
MONTHSE3
YEARSA
YEARSB
YEARSC
YEARSD1
YEARSD2
YEARSE1
YEARSE2
SEXSAT
SEXMO
NSEXMO
RASAT1
RASAT2
RASAT3
RASAT4
RASAT5
RSATIS
SATISBC
PILL
PATCH
RING
DEPO
IUD
IMPLANT
YPILL
YPATCH
YRING
YDEPO
YIMPLANT
YIUD
MPILL
MPATCH
MRING
MDEPO
MIMPLANT
MIUD
Q23A_PILL
Q23A_PATCH
Q23A_RING
Q23A_DEPO
Q23A_IMPLANT
Q23A_IUD
TIMEUSE
FREQBAR
FREQBARB
WITHDRAW
VASECTOMY
CONDOM
NFP
SPERM
NOBARRIER
XBARR
DOV_Q26_1
DOV_Q26_2
DOV_Q26_3
DOV_Q26_4
DOV_Q26_5
DOV_Q26_6
DOV_Q26_REFUSED
Time

```{r}
#Select variables 

Fake_cccu_complete1 <- Fake_cccu_complete %>% 
  select(CASEID, WAVE,AGE, DEGREE,
        POVRATE, TYPEINS,MEDPROB,
        GAPINS, HLTHPROB, AVOID, FEELPG,
        NBIRTHS, BIRTH3MO, PREG, MONTHSA,
        MONTHSB, MONTHSC, MONTHSD1, MONTHSD3,
        MONTHSE1, MONTHSE3, YEARSA, YEARSB,
        YEARSC, YEARSD1, YEARSD2, YEARSE1,
        YEARSE2, SEXSAT,
        SEXMO, NSEXMO, starts_with("RSAT"),#includes RSATIS as overall measure for satisfaciton with barrier methods
        SATISBC, starts_with("Q23D"),HORMONAL,
        PILL,PATCH,RING,DEPO,IUD,
        IMPLANT, YPILL, YPATCH, YRING,
        YDEPO, YIMPLANT, YIUD, MPILL, MPATCH,
        MRING, MDEPO, MIMPLANT, MIUD,
        starts_with("Q23A_"), TIMEUSE, WITHDRAW,VASECTOMY,CONDOM,
        NFP,SPERM,NOBARRIER,XBARR, starts_with("DOV_Q26_"))

#double check column WAVE
table(Fake_cccu_complete1$WAVE) #happy :) 
```


#4. Variable Wrangling 

##4.0 Wave
```{r}
Fake_cccu_complete1$WAVE <- as.factor(Fake_cccu_complete1$WAVE)

class(Fake_cccu_complete1$WAVE)
```

##4.1 Degree
```{r}
#Overview over Column
table(Fake_cccu_complete1$DEGREE)
```
Values are:
(-2) Not asked                                  (-1) refused 
(01) No formal education 
(02) 1st, 2nd, 3rd, or 4th grade
(03) 5th or 6th grade
(04) 7th or 8th grade 
(05) 9th grade 
(06) 10th grade 
(07) 11th grade 
(08) 12th grade NO DIPLOMA 
(09) HIGH SCHOOL GRADUATE - high school DIPLOMA or the equivalent (GED) 
(10) Some college, no degree 
(11) Associate degree 
(12) Bachelors degree 
(13) Masters degree 
(14) Professional or Doctorate degree 

we want to keep all numbers (not necessary to summarize in one category) and there is no category twice (with different number), we can simply recode it 



```{r}
Fake_cccu_complete1<- Fake_cccu_complete1 %>%
  mutate(DEGREE_recode = recode(DEGREE,
                                "(-2) Not asked"="NA",
                                "(-1) refused"="NA",
                                "(01) No formal education" ="1",
                                "(02) 1st, 2nd, 3rd, or 4th grade" = "2",
                                "(03) 5th or 6th grade" = "3",
                                "(04) 7th or 8th grade" = "4",
                                "(05) 9th grade" = "5",
                                "(06) 10th grade" = "6",
                                "(07) 11th grade" = "7",
                                "(08) 12th grade NO DIPLOMA" = "8",
                                "(09) HIGH SCHOOL GRADUATE - high school DIPLOMA or the equivalent (GED)" = "9",
                                "(10) Some college, no degree" = "10",
                                "(11) Associate degree" = "11",
                                "(12) Bachelors degree" = "12",
                                "(13) Masters degree" = "13",
                                "(14) Professional or Doctorate degree" = "14" 
))
table(Fake_cccu_complete1$DEGREE)
table(Fake_cccu_complete1$DEGREE_recode)

#Factorizing it with levels
Fake_cccu_complete1$DEGREE_recode<-
factor(Fake_cccu_complete1$DEGREE_recode, levels = c(1,2,3,4,5,6,7,8,9,10,11,12,13,14), labels = c("no formal education", "1st to 4th grade", "5th/6th grade", "7th/8th grade", "9th grade", "10th grade", "11th grade", "12th grade / no diploma", "high school diploma or equivalent", "some college, no degree", "associate degree", "bachelors degree", "masters degree", "professional or doctoral degree"))


plot(Fake_cccu_complete1$DEGREE_recode)
```


## 4.2 Age
```{r}
#overview

table(Fake_cccu_complete1$AGE)

#as.numeric
Fake_cccu_complete1$AGE <- as.numeric(Fake_cccu_complete1$AGE)

class(Fake_cccu_complete1$AGE)

hist(Fake_cccu_complete1$AGE)
```


##4.3 POVERTY: POVRATE 

```{r}
table(Fake_cccu_complete1$POVRATE)

Fake_cccu_complete1$POVRATE <- as.numeric(Fake_cccu_complete1$POVRATE)

class(Fake_cccu_complete1$POVRATE)

hist(Fake_cccu_complete1$POVRATE)
```


##4.4 TYPE of INSURANCE
```{r}
#Overview
table(Fake_cccu_complete1$TYPEINS)
```
I recode variable with 2 Levels: yes (1), no (2), NA


```{r}
Fake_cccu_complete1<- Fake_cccu_complete1 %>%
  mutate(TYPEINS_recode = recode(TYPEINS,
                                "(-1) Refused"= "NA",
                                "(1) Private health insurance I get through my job or school, a family member or that I pay for myself." ="1",
                                "(2) (Medicaid Program - BASED ON PPSTATEN) or some other government-sponsored health insurance." = "1",
                                "(3) Some other type of health insurance" = "1",
                                "(4) I don't have health insurance." = "0",
                                "(2) {#\\.POV_Q38} or some other government-sponsored health insurance." = "1",
                                "(0) Insurance obtained through a health insurance marketplace or exchange, such as www.healthcare.gov or {state-specific mar" = "1",
                                "(1) Private health insurance that I get through my job or school, a family member or that I pay for myself." = "1",
                                "(2) {PPSTATE} or some other government-sponsored health insurance." = "1",
                                "(5) Insurance obtained through a health insurance marketplace or exchange, such as www.healthcare.gov{#POV_PROGNAME_Q" = "1"))

table(Fake_cccu_complete1$TYPEINS_recode)
sum(is.na(Fake_cccu_complete1$TYPEINS))

#Factorize
Fake_cccu_complete1$TYPEINS_recode<- factor(Fake_cccu_complete1$TYPEINS_recode, levels = c(0,1), labels = c("No", "Yes"))
table(Fake_cccu_complete1$TYPEINS_recode)

plot(Fake_cccu_complete1$TYPEINS_recode)

```

##4.5 MEDICAL PROBLEMS
```{r}
table(Fake_cccu_complete1$MEDPROB)

Fake_cccu_complete1<- Fake_cccu_complete1 %>%
  mutate(MEDPROB_recode = recode(MEDPROB,
                                 "(0) No"="0",
                                 "(1) Yes" ="1"))



#factorize
Fake_cccu_complete1$MEDPROB_recode<- factor(Fake_cccu_complete1$MEDPROB_recode, levels = c(0,1), labels = c("No", "Yes"))
table(Fake_cccu_complete1$MEDPROB_recode)

plot(Fake_cccu_complete1$MEDPROB_recode)
```

##4.6 GAPS in INSURANCE

```{r}
#overview
table(Fake_cccu_complete1$GAPINS)
#recode
Fake_cccu_complete1<- Fake_cccu_complete1 %>%
  mutate(GAPINS_recode = recode(GAPINS,
                                 "(0) no"="0",
                                "(1) yes"="1"))
#control
table(Fake_cccu_complete1$GAPINS_recode)
#factorize
Fake_cccu_complete1$GAPINS_recode<-factor(Fake_cccu_complete1$GAPINS_recode, levels = c(0,1), labels = c("No", "Yes"))

plot(Fake_cccu_complete1$GAPINS_recode)
```

##4.7 HEALTH PROBLEMS
```{r}
#overview
table(Fake_cccu_complete1$HLTHPROB)

```
Recoding values

```{r}
#Recoding
Fake_cccu_complete1<- Fake_cccu_complete1 %>%
  mutate(HLTHPROB_recode = recode(HLTHPROB,
                                    "(-1) Refused"="NA",
                                  "(0) No"="0",
                                  "(1) Yes"="1",
                                  "(3) Dont Know"="NA",
                                  "(4) Didnt care"="NA"))
table(Fake_cccu_complete1$HLTHPROB_recode)
#factorize
Fake_cccu_complete1$HLTHPROB_recode<-factor(Fake_cccu_complete1$HLTHPROB_recode, levels = c(0,1), labels = c("No", "Yes"))

sum(is.na(Fake_cccu_complete1$HLTHPROB_recode))


plot(Fake_cccu_complete1$HLTHPROB_recode)
```


##4.8 Avoid Pregnancy
```{r}
#overview
table(Fake_cccu_complete1$AVOID)
#recode

Fake_cccu_complete1 <- Fake_cccu_complete1 %>%
  mutate(Avoid_recode = ifelse(AVOID == "(1) Not at all important to avoid pregnancy 1", 1, ifelse(AVOID == "(2) 2", 2,
                                                                                                   ifelse(AVOID == "(3) 3", 3, 
                                                                                                          ifelse(AVOID == "(4) 4", 4, 
                                                                                                                 ifelse(AVOID == "(5) 5", 5, ifelse(AVOID == "(6) Very important to avoid pregnancy 6",6, NA))))))) 
table(Fake_cccu_complete1$Avoid_recode)             
    
sum(is.na(Fake_cccu_complete1$AVOID))   
sum(is.na(Fake_cccu_complete1$Avoid_recode))
Fake_cccu_complete1$Avoid_recode <- as.numeric(Fake_cccu_complete1$Avoid_recode)
class(Fake_cccu_complete1$Avoid_recode)


hist(Fake_cccu_complete1$Avoid_recode)
```


##4.9 FEEL About Pregnancy
```{r}
#overview
table(Fake_cccu_complete1$FEELPG)

#recode

Fake_cccu_complete1 <- Fake_cccu_complete1 %>%
  mutate(FEELPG_recode = ifelse(FEELPG == "(1) Not at all happy to be pregnant 1", 1, ifelse(FEELPG == "(2) 2", 2, 
                                                                                                   ifelse(FEELPG == "(3) 3", 3, 
                                                                                                          ifelse(FEELPG == "(4) 4", 4, 
                                                                                                                 ifelse(FEELPG == "(5) 5", 5, ifelse(FEELPG == "(6) Very happy to be pregnant 6",6, NA)))))))


table(Fake_cccu_complete1$FEELPG_recode)
sum(is.na(Fake_cccu_complete1$FEELPG_recode))

Fake_cccu_complete1$FEELPG_recode <- as.numeric(Fake_cccu_complete1$FEELPG_recode)


hist(Fake_cccu_complete1$FEELPG_recode)

```

##4.10 NUMBER of Kids at t1
```{r}
table(Fake_cccu_complete1$NBIRTHS)
Fake_cccu_complete1<- Fake_cccu_complete1 %>%
  mutate(NKIDS_t1 = recode(NBIRTHS,
                                    "(0) 0"="0",
                                  "(1) 1"="1",
                                 "(2) 2" = "2",
                                 "(3) 3" = "3",
                                 "(4) 4 or more" = "4"))
table(Fake_cccu_complete1$NKIDS_t1)
#factorize
Fake_cccu_complete1$NKIDS_t1<-factor(Fake_cccu_complete1$NKIDS_t1, levels = c(0,1,2,3,4), labels = c("0", "1", "2", "3", "4 or more"))


#fill for each wave after t1 (for t2,t3,t4)
Fake_cccu_complete1 = Fake_cccu_complete1 %>%
group_by(CASEID) %>%
fill(NKIDS_t1)


plot(Fake_cccu_complete1$NKIDS_t1)
```


##4.11 Pregnant between two waves?
Since September 2012, did you experience any of the following?

```{r}
#overview
table(Fake_cccu_complete1$PREG)

#recode

Fake_cccu_complete1 <- Fake_cccu_complete1 %>%
  mutate(pregnant_between_waves = ifelse(PREG == "(3) I had a baby" | 
                                          PREG == "(1) I had a miscarriage" |
                                          PREG== "(2) I had an abortion" |
                                          PREG == "(4) I", 1, ifelse(FEELPG == "(-1) Refused", NA, 0)))


table(Fake_cccu_complete1$pregnant_between_waves)
sum(is.na(Fake_cccu_complete1$pregnant_between_wave))

#factorize
Fake_cccu_complete1$pregnant_between_waves<-factor(Fake_cccu_complete1$pregnant_between_waves, levels = c(0,1), labels = c("No", "Yes"))
```


##4.12 had_baby_between_waves
Since September 2012, did you experience any of the following?: I had a baby
```{r}
#overview
table(Fake_cccu_complete1$PREG)

#recoding in 0 = no baby and 1 = baby

Fake_cccu_complete1 <- Fake_cccu_complete1 %>%
  mutate(had_baby_between_waves = ifelse(PREG=="(3) I had a baby", 1, ifelse(PREG == "(-1) Refused", NA, 0)))

table(Fake_cccu_complete1$had_baby_between_waves)
#factorize

Fake_cccu_complete1$abortion<-factor(Fake_cccu_complete1$had_baby_between_waves, levels = c(0,1), labels = c("No", "Yes"))
```


##4.13 Relationship Duration

Q3bA usw --> immer wenn Missing oder Refused Missing in Jahren 
wenn jemand A angegebene hat-> A Hauptpartner = verehiratet
wenn jemand B angegeben hat aber nicht A -> B Hauptpartner (nicht verheiratet)
C = Dating
D1 = 2. Dating Partner (sollte es nur geben, wenn es C auch gibt), wenn C angegeben und D1 nutzen wir C (immer auf Partner davor)
--> sind keine Singeles sonder kürzere Beziehung 
--> die die in Q3BAAbC Missing/Refsued haben sind single --> sollte missing haben in Years und Months (anders wissen wir es nicht) 
--> eine Spalte; wir nehmen A oder B oder C je nachdem was sie angeben 



##4.14 SEXUAL SATISFACTION: How satisfied is R in his / her sexual relationship?

```{r}
#overview
table(Fake_cccu_complete1$SEXSAT)

#recoding
Fake_cccu_complete1 <- Fake_cccu_complete1 %>%
  mutate(sexual_satisfaction = ifelse(SEXSAT == "1", 1, 
                                      ifelse(SEXSAT == "2", 2, 
                                                                                                   ifelse(SEXSAT == "3", 3, 
                                                                                                          ifelse(SEXSAT == "4", 4, 
                                                                                                                 ifelse(SEXSAT == "5", 5, ifelse(SEXSAT == "6",6, NA)))))))


Fake_cccu_complete1$sexual_satisfaction <- as.numeric(Fake_cccu_complete1$sexual_satisfaction)
                                 
table(Fake_cccu_complete1$sexual_satisfaction)


```


## 4.15 SEX In LAST 30 days? SEXMO
```{r}
#overview
table(Fake_cccu_complete1$SEXMO)

#recoding
Fake_cccu_complete1<- Fake_cccu_complete1 %>%
  mutate(sex_inlast30days = recode(SEXMO,
                                    "(-1) Refused"="NA",
                                  "(0) No"="0",
                                 "(1) Yes" = "1",
                                 "(3) Dont Know" = "NA",
                                 "(4) Didnt care" = "NA"))
table(Fake_cccu_complete1$sex_inlast30days)

#factorize
Fake_cccu_complete1$sexmo_recoded<-factor(Fake_cccu_complete1$sex_inlast30days, levels = c(0,1), labels = c("No", "Yes")) 

sum(is.na(Fake_cccu_complete1$sex_inlast30days))

```


##4.16 Sexual Frequency: NSEXMO: how many times sex in last 30 days

```{r}
#overview:
table(Fake_cccu_complete1$NSEXMO)

#overview
table(Fake_cccu_complete1$SEXMO)

#building sexual frequency: if sex_inlast30days = 0 ("No") we want 0, if NSEXMO = 1 we want 1, if NSEXMO 2 = 2, 3 =3, 4 = 4, otherwise NA

Fake_cccu_complete1 <- Fake_cccu_complete1 %>%
  mutate(sexual_frequency = ifelse(sex_inlast30days == "0", 0, 
                                      ifelse(NSEXMO == "(1) 1", 1, 
                                                                                                   ifelse(NSEXMO == "(2) 2-5", 2, 
                                                                                                          ifelse(NSEXMO == "(3) 6-10", 3, 
                                                                                                                 ifelse(NSEXMO == "(4) 11 or more", 4, NA))))))
table(Fake_cccu_complete1$sexual_frequency)


#factorize
Fake_cccu_complete1$sexual_frequency<-factor(Fake_cccu_complete1$sexual_frequency, levels = c(0,1,2,3,4), labels = c("No sex", "Once", "2-5 times", "6-10 times", "11 or more times")) 

```


##4.17 Contraceptive Satisfaction 
Wenn ich - 1x hormonell + 1x nicht-hormonell vorliegen habe (betrifft auch 1 mal nur hormonell) dann nehme ich die Zufriedenheit mit der spezifischen hormonellen Methode 

Wenn ich 2x hormonell vorliegen habe, dann nehme ich den höherer Zufriedenheitswert bei den jeweiligen beiden hormonellen Methoden

Wenn ich 1x oder 2x nicht-hormonell vorliegen habe, dann nehme ich den höherer Zufriedenheitswert bei den jeweiligen beiden nicht-hormonellen Methoden.

Items: Q23D PILL PATCH IMPLANT IUD RING DEPO
       RSAT1 (withdrawl), 3(condoms), 4(natural/calendar), 5(spermicid/other, 2(vasectomy)

```{r}
#overview over items: satisfation with hc method
table(Fake_cccu_complete1$Q23D_PILL) 
table(Fake_cccu_complete1$Q23D_PATCH)
table(Fake_cccu_complete1$Q23D_IMPLANT)
table(Fake_cccu_complete1$Q23D_DEPO)
table(Fake_cccu_complete1$Q23D_IUD)
table(Fake_cccu_complete1$Q23D_RING)

#overview HORMONAL
table(Fake_cccu_complete1$HORMONAL)

#says if Vpn used Pill, patch etc or multiple or no hc method 

#overview over items: satisfaction with non_hc method

table(Fake_cccu_complete1$RSAT1)
table(Fake_cccu_complete1$RSAT2)
table(Fake_cccu_complete1$RSAT3)
table(Fake_cccu_complete1$RSAT4)
table(Fake_cccu_complete1$RSAT5)



```




#4.18 Contraceptive Duration


#4.19 hc use:grouping

```{r}
Fake_cccu_complete1 <- Fake_cccu_complete1 %>%
  mutate(hc = ifelse(PILL %contains% "1"|
                       PATCH %contains% "1" |
                       RING %contains% "1" |
                       DEPO %contains% "1" |
                       IMPLANT %contains% "1", 1,
                     ifelse(IUD %contains% "1", NA, 0)))

table(Fake_cccu_complete1$hc)

crosstabs(~IUD + hc, data = Fake_cccu_complete1)

#factorizing
Fake_cccu_complete1$hc<-factor(Fake_cccu_complete1$hc, levels = c(0,1), labels = c("non_hc", "hc")) 
```

#4.20 switch 

#5. Saving Data
```{r}
save(Fake_cccu_complete1,file = "Fake_cccu_complete1.RData")

load("Fake_cccu_complete1.RData")
```





